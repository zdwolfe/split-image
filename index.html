<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Image Splitter - Easily split images into multiple parts directly in your browser. Useful for Threads Image Pinch To Merge.">
    <meta name="keywords" content="Image Splitter, Image Slicing, Online Tool, Image Processing, Threads Pinch, Threads, Threads Images, Instagram">
    <title>Image Splitter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        img {
            max-width: 45%;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div>
        <h3>Image Splitter v0.1.7</h3>
        <p>Split images in your browser, for Threads (Pinch Merge), Instagram, and other social media.</p>
    </div>
    
    <div>
        <form id="upload-form">
            <label for="file-input">Image:</label>
            <input type="file" id="file-input" accept="image/*" />

            <br/><br/>

            <label for="slice-input">Parts:</label>
            <input type="number" id="slice-input" value="2" min="1" max="16" />
            
            <br/><br/>

            <label for="watermark-input">
                <input type="checkbox" id="watermark-input" />Add watermark <small>(share this site with your friends)?</small>
            </label>
            <br/><br/>
            <button type="submit">Submit</button>
        </form>
    </div>

    <div id="image-container"></div>

    <script>
        const fileInput = document.getElementById('file-input');
        const sliceInput = document.getElementById('slice-input');
        const watermarkInput = document.getElementById('watermark-input');
        const uploadForm = document.getElementById('upload-form');
        const imageContainer = document.getElementById('image-container');

        uploadForm.addEventListener('submit', (event) => {
            event.preventDefault();

            imageContainer.innerHTML = '';

            const file = fileInput.files[0];
            if (!file) {
                return;
            }

            const numberOfSlices = parseInt(sliceInput.value);
            if (isNaN(numberOfSlices) || numberOfSlices < 1) {
                return;
            }

            const reader = new FileReader();

            reader.onload = function(e) {
                const img = new Image();
                img.src = e.target.result;

                img.onload = function() {
                    const { width, height } = getResizedDimensions(img.width, img.height);
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = width;
                    canvas.height = height;

                    ctx.drawImage(img, 0, 0, width, height);

                    const resizedDataUrl = canvas.toDataURL('image/png');
                    const resizedImg = new Image();
                    resizedImg.src = resizedDataUrl;

                    resizedImg.onload = function() {
                        processImage(resizedImg, numberOfSlices);
                    };
                };
            };

            reader.readAsDataURL(file);

            gtag('event', 'submit', {
                'event_category': 'Form',
                'event_label': 'Image Splitter Form',
            });
        });

        function getResizedDimensions(width, height) {
            const maxSize = 1920 * 1080;
            const aspectRatio = width / height;

            if (width * height <= maxSize) {
                return { width, height };
            }

            if (aspectRatio > 1) {
                width = Math.sqrt(maxSize * aspectRatio);
                height = maxSize / width;
            } else {
                height = Math.sqrt(maxSize / aspectRatio);
                width = maxSize / height;
            }

            return { width: Math.floor(width), height: Math.floor(height) };
        }

        function processImage(img, numberOfSlices) {
            const sliceWidth = img.width / numberOfSlices;
            const shouldWatermark = watermarkInput.checked;

            for (let i = 0; i < numberOfSlices; i++) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = sliceWidth;
                canvas.height = img.height;

                ctx.drawImage(img, i * sliceWidth, 0, sliceWidth, img.height, 0, 0, sliceWidth, img.height);

                if (shouldWatermark && i === numberOfSlices - 1) {
                    ctx.font = '10px Arial';
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    const watermarkText = 'zdwolfe.github.io/split-image';
                    const textMetrics = ctx.measureText(watermarkText);
                    ctx.fillText(watermarkText, canvas.width - textMetrics.width - 2, canvas.height - 2);
                }

                const dataUrl = canvas.toDataURL('image/png');
                renderImage(dataUrl, `slice-${i + 1}.png`);
            }
        }

        function renderImage(dataUrl, filename) {
            const img = document.createElement('img');
            img.src = dataUrl;
            img.alt = filename;
            img.addEventListener('click', () => downloadImage(dataUrl, filename));
            imageContainer.appendChild(img);
        }

        function downloadImage(dataUrl, filename) {
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FEZ8BJE1VJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-FEZ8BJE1VJ');
    </script>
</body>
</html>
